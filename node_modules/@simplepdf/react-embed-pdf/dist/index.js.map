{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport \"./styles.scss\";\n\nexport type EmbedEvent =\n  | { type: \"DOCUMENT_LOADED\"; data: { document_id: string } }\n  | { type: \"SUBMISSION_SENT\"; data: { submission_id: string } };\n\ninterface Props {\n  children: React.ReactElement;\n  companyIdentifier?: string;\n  onEmbedEvent?: (event: EmbedEvent) => Promise<void> | void;\n}\n\nconst CloseIcon: React.FC = () => (\n  <svg\n    height=\"512\"\n    viewBox=\"0 0 512 512\"\n    width=\"512\"\n    xmlSpace=\"preserve\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path d=\"M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z\" />\n  </svg>\n);\n\nexport const EmbedPDF: React.FC<Props> = ({\n  children,\n  companyIdentifier,\n  onEmbedEvent,\n}) => {\n  const editorDomain = React.useMemo(\n    () => `https://${companyIdentifier ?? \"embed\"}.simplepdf.eu`,\n    [companyIdentifier]\n  );\n\n  const [shouldDisplayModal, setShouldDisplayModal] = React.useState(false);\n\n  React.useEffect(() => {\n    if (onEmbedEvent === undefined) {\n      return;\n    }\n\n    const eventHandler = async (event: MessageEvent<string>) => {\n      if (event.origin !== editorDomain) {\n        return;\n      }\n\n      const payload: EmbedEvent | null = (() => {\n        try {\n          return JSON.parse(event.data);\n        } catch (e) {\n          console.error(\"Failed to parse iFrame event payload\");\n          return null;\n        }\n      })();\n\n      switch (payload?.type) {\n        case \"DOCUMENT_LOADED\":\n        case \"SUBMISSION_SENT\":\n          await onEmbedEvent(payload);\n          return;\n\n        default:\n          return;\n      }\n    };\n\n    if (!shouldDisplayModal) {\n      window.removeEventListener(\"message\", eventHandler);\n      return;\n    }\n\n    window.addEventListener(\"message\", eventHandler, false);\n\n    return () => window.removeEventListener(\"message\", eventHandler);\n  }, [shouldDisplayModal, editorDomain, onEmbedEvent]);\n  const handleAnchorClick = React.useCallback((e: Event) => {\n    e.preventDefault();\n    setShouldDisplayModal(true);\n  }, []);\n\n  const handleCloseModal = React.useCallback(() => {\n    setShouldDisplayModal(false);\n  }, []);\n\n  const simplePDFUrl = React.useMemo(() => {\n    const baseURL = `${editorDomain}/editor`;\n\n    if (!children.props.href) {\n      return baseURL;\n    }\n\n    const sanitizedURL = encodeURIComponent(children.props.href);\n\n    return `${baseURL}?open=${sanitizedURL}`;\n  }, [editorDomain, children.props.href]);\n\n  return (\n    <>\n      {shouldDisplayModal &&\n        createPortal(\n          <div className=\"simplePDF_container\" aria-modal=\"true\">\n            <div className=\"simplePDF_content\">\n              <button\n                onClick={handleCloseModal}\n                className=\"simplePDF_close\"\n                aria-label=\"Close PDF editor modal\"\n              >\n                <CloseIcon />\n              </button>\n              <div className=\"simplePDF_iframeContainer\">\n                <iframe\n                  referrerPolicy=\"no-referrer-when-downgrade\"\n                  className=\"simplePDF_iframe\"\n                  src={simplePDFUrl}\n                />\n              </div>\n            </div>\n          </div>,\n          document.body\n        )}\n\n      {React.cloneElement(children, { onClick: handleAnchorClick })}\n    </>\n  );\n};\n"],"names":["React","createPortal"],"mappings":"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"}